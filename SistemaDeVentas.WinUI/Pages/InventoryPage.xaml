<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SistemaDeVentas.WinUI.Pages.InventoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                CornerRadius="8" Margin="16,16,16,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Gestión de Inventario" Style="{ThemeResource TitleTextBlockStyle}"/>
                    <TextBlock Text="{x:Bind ViewModel.ProductCount, Mode=OneWay}" 
                               Style="{ThemeResource CaptionTextBlockStyle}" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Style="{StaticResource PrimaryButtonStyle}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE710;"/>
                                <TextBlock Text="Nuevo Producto"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                    <Button Style="{StaticResource FluentButtonStyle}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B5;"/>
                                <TextBlock Text="Importar"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                    <Button Style="{StaticResource FluentButtonStyle}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B6;"/>
                                <TextBlock Text="Exportar"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filters and Search -->
        <Border Grid.Row="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                CornerRadius="8" Margin="16,0,16,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <AutoSuggestBox Grid.Column="0" 
                                PlaceholderText="Buscar productos por nombre, código o categoría..."
                                QueryIcon="Find"
                                Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"/>

                <ComboBox Grid.Column="2" 
                          Header="Categoría" 
                          PlaceholderText="Todas"
                          ItemsSource="{x:Bind ViewModel.Categories}"
                          SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"/>

                <ComboBox Grid.Column="4" 
                          Header="Estado" 
                          PlaceholderText="Todos"
                          SelectedItem="{x:Bind ViewModel.SelectedStatus, Mode=TwoWay}">
                    <ComboBoxItem Content="Todos"/>
                    <ComboBoxItem Content="Activos"/>
                    <ComboBoxItem Content="Inactivos"/>
                    <ComboBoxItem Content="Sin Stock"/>
                    <ComboBoxItem Content="Stock Bajo"/>
                </ComboBox>

                <Button Grid.Column="6" Content="Limpiar Filtros" VerticalAlignment="Bottom"
                        Style="{StaticResource FluentButtonStyle}"/>
            </Grid>
        </Border>

        <!-- Products DataGrid -->
        <Border Grid.Row="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8" Margin="16,0,16,16" Padding="16">
            <Grid x:Name="InventoryPageGrid">
                <Grid.RenderTransform>
                    <TranslateTransform />
                </Grid.RenderTransform>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Grid Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Lista de Productos" 
                               Style="{ThemeResource SubtitleTextBlockStyle}"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                        <ToggleButton Content="Vista Compacta" IsChecked="True"/>
                        <Button>
                            <FontIcon Glyph="&#xE72C;"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Products List -->
                <ListView Grid.Row="1" x:Name="ProductsListView" 
                          ItemsSource="{x:Bind ViewModel.Products}"
                          SelectionMode="Extended">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="12" Background="{ThemeResource SubtleFillColorTransparentBrush}" 
                                  CornerRadius="4" Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Product Image Placeholder -->
                                <Border Grid.Column="0" Background="{ThemeResource AccentFillColorDefaultBrush}" 
                                        CornerRadius="4" Width="48" Height="48">
                                    <FontIcon Glyph="&#xE7C1;" Foreground="White"/>
                                </Border>

                                <!-- Product Info -->
                                <StackPanel Grid.Column="1" Margin="12,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Code}" 
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{Binding CategoryName}" 
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                </StackPanel>

                                <!-- Stock -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0">
                                    <TextBlock Text="{Binding Stock}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Stock" Style="{ThemeResource CaptionTextBlockStyle}" 
                                               HorizontalAlignment="Center"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <!-- Price -->
                                <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="16,0">
                                    <TextBlock Text="{Binding FormattedSalePrice}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Precio" Style="{ThemeResource CaptionTextBlockStyle}" 
                                               HorizontalAlignment="Center"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>

                                <!-- Status -->
                                <Border Grid.Column="4" Background="{Binding StatusColor}" 
                                        CornerRadius="12" Padding="8,4" Margin="16,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding StatusText}" 
                                               Foreground="White" 
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               FontWeight="SemiBold"/>
                                </Border>

                                <!-- Actions -->
                                <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="4" Margin="16,0,0,0">
                                    <Button Style="{StaticResource FluentButtonStyle}" Padding="8"
                                            ToolTipService.ToolTip="Editar producto">
                                        <FontIcon Glyph="&#xE70F;" FontSize="16"/>
                                    </Button>
                                    <Button Style="{StaticResource FluentButtonStyle}" Padding="8"
                                            ToolTipService.ToolTip="Duplicar producto">
                                        <FontIcon Glyph="&#xE8C8;" FontSize="16"/>
                                    </Button>
                                    <Button Style="{StaticResource FluentButtonStyle}" Padding="8"
                                            ToolTipService.ToolTip="Eliminar producto">
                                        <FontIcon Glyph="&#xE74D;" FontSize="16" Foreground="{StaticResource ErrorBrush}"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Pagination -->
                <Grid Grid.Row="2" Margin="0,16,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="{x:Bind ViewModel.PaginationInfo, Mode=OneWay}" 
                               VerticalAlignment="Center"
                               Style="{ThemeResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                        <Button Content="Anterior" IsEnabled="{x:Bind ViewModel.CanGoPrevious, Mode=OneWay}"/>
                        <TextBlock Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}" 
                                   VerticalAlignment="Center" Margin="16,0"/>
                        <Button Content="Siguiente" IsEnabled="{x:Bind ViewModel.CanGoNext, Mode=OneWay}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>

    <!-- Page Animations -->
    <Page.Resources>
        <Storyboard x:Key="PageLoadStoryboard">
            <DoubleAnimation Storyboard.TargetName="InventoryPageGrid"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.5"/>
            <DoubleAnimation Storyboard.TargetName="InventoryPageGrid"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="20" To="0" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Page.Resources>
</Page>